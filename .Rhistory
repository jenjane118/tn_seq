if (!is.na(bovis_df$descr.product)[i]){
prot_table$PRODUCT[i]<-bovis_df[i,4]
}
# start and end
# make sure start and end in right order (could be switched?)
if (bovis_df[i,7]<bovis_df[i,6]){
prot_table$START[i]<-bovis_df[i,7]
prot_table$END[i]<-bovis_df[i,6]
} else {
prot_table$START[i]<-bovis_df[i,6]
prot_table$END[i]<-bovis_df[i,7]
}
# strand
prot_table$STRAND[i]<-as.character(bovis_df$strand[i])
# type
if (!is.na(bovis_df$descr.type)[i]){
prot_table$TYPE[i]<-as.character(bovis_df$descr.type[i])
}
# GAP
prot_table$GAP[i]<-"-"
# enter cells in dataframe if note is present:
if (length(note)>0){
# if type = Repeat, no aa len (nt length), in these is inputing '37' for aa_len (from H37Rv?)
# aa_length
if (length(aa_len)>0){
prot_table$AA_LEN[i]<-aa_len
}
# gene name
if (length(gene_name)>0){
prot_table$NAME[i]<-gene_name
}
# orf
if (length(orf)>0){
prot_table$ORF_ID[i]<-orf
}
}
# gene name if no note:
else if (length(bovis_df$descr.gene[i])>0){
prot_table$NAME[i]<-bovis_df$descr.gene[i]
}
# ORF id if no note (from locus-id)
else {
prot_table$ORF_ID[i]<-substr(bovis_df$descr.locus_tag[i],8, nchar(bovis_df$descr.locus_tag[i]))
}
}
View(prot_table)
for (i in 1:nrow(bovis_df)){
#for (i in 1949:1950){
# product, gene name, ORF id and aa len must be parsed from column 9 ()
orf<-''
gene_name<-''
aa_len<-''
if (is.na(bovis_df$descr.note[i])){
note<-''
}
# if tRNA
else if (bovis_df$descr.type[i]=="tRNA"){
note<-unlist(strsplit(bovis_df[i,3],split = ","))
orf<-note[1]
gene_name <- note[1]
#aa_len <- substr(note[3], 6, nchar(note[3]))
}
# if repeat region
else if (bovis_df$descr.type[i]=="repeat_region"){
note<-unlist(strsplit(bovis_df[i,3],split = ","))
orf<-note[1]
gene_name <- note[4]
}
else {
note<-unlist(strsplit(bovis_df[i,3],split = ","))
orf<-note[1]
gene_name<- note[2]
len<- substr(note[4], 7, nchar(note[4]))
# get only integers from len string:
x<- gregexpr("[0-9]+", len)
aa_len <- as.numeric(unlist(regmatches(len, x)))
#aa_len<- data[grep("[0-9]+", len),]
}
# product
if (!is.na(bovis_df$descr.product)[i]){
prot_table$PRODUCT[i]<-bovis_df[i,4]
}
# start and end
# make sure start and end in right order (could be switched?)
if (bovis_df[i,7]<bovis_df[i,6]){
prot_table$START[i]<-bovis_df[i,7]
prot_table$END[i]<-bovis_df[i,6]
} else {
prot_table$START[i]<-bovis_df[i,6]
prot_table$END[i]<-bovis_df[i,7]
}
# strand
prot_table$STRAND[i]<-as.character(bovis_df$strand[i])
# type
if (!is.na(bovis_df$descr.type)[i]){
prot_table$TYPE[i]<-as.character(bovis_df$descr.type[i])
}
# GAP
prot_table$GAP[i]<-"-"
# enter cells in dataframe if note is present:
if (length(note)>0){
# if type = Repeat, no aa len (nt length), in these is inputing '37' for aa_len (from H37Rv?)
# aa_length
if (length(aa_len)>0){
prot_table$AA_LEN[i]<-aa_len
}
# gene name
if (length(gene_name)>0){
prot_table$NAME[i]<-gene_name
}
# orf
if (length(orf)>0){
prot_table$ORF_ID[i]<-orf
}
}
# gene name if no note:
else if (length(bovis_df$descr.gene[i])>0){
prot_table$NAME[i]<-bovis_df$descr.gene[i]
}
# ORF id if no note (from locus-id)
else {
prot_table$ORF_ID[i]<-substr(bovis_df$descr.locus_tag[i],8, nchar(bovis_df$descr.locus_tag[i]))
}
}
View(prot_table)
options(scipen=999,stringsAsFactors = F)
library(Rsamtools)
features_table<-read.csv("M_bovis_features-locusAsName-aug19.csv",header=T)
sample_names<-read.table("names.txt",stringsAsFactors = F)
what<-c("pos")
what
j
#for (j in 1:nrow(sample_names)){
j<-c("B_S1_L001_R1_001")
j
summary_stats<-as.data.frame(matrix(0, nrow = nrow(features_table), ncol = 15))
summary_stats[,1:3]<-features_table[,3:5]
summary_stats[,4:5]<-features_table[,1:2]
colnames(summary_stats)<-c("Name","Type","Product","Start","End","Gene Length","No.Insertion sites", "Insertion Index", "Av. Coverage","No.Insertion sites DP>5", "Insertion Index DP>5", "Av. Coverage DP>5","Pos. IS","No.reads per IS","Total no. IS")
for (i in 1:nrow(features_table)){
if (summary_stats$End[i]>summary_stats$Start[i]){
summary_stats$`Gene Length`[i]<-(as.numeric(summary_stats$End[i])-as.numeric(summary_stats$Start[i]))+1
range1 <- IRanges(features_table$START[i],features_table$END[i])
which<-IRangesList(LT708304.1=range1)
} else {
summary_stats$`Gene Length`[i]<-(as.numeric(summary_stats$Start[i])-as.numeric(summary_stats$End[i]))+1
range2<- IRanges(features_table$END[i],features_table$START[i])
which<-IRangesList(LT708304.1=range2)
}
param<-ScanBamParam(what=what,which = which)
reads<-scanBam(paste(sample_names[j,1],".sort.bam",sep = ""),param = param)[[1]]
a<-unique(reads$pos)
if (length(a>=1)){
summary_stats$`No.Insertion sites`[i]<-length(a)
summary_stats$`Pos. IS`[i]<-paste(a,collapse = ",")
summary_stats$`Insertion Index`[i]<-as.numeric(summary_stats$`No.Insertion sites`[i])/as.numeric(summary_stats$`Gene Length`[i])
insertionsite<-as.data.frame(matrix(NA, nrow = 1, ncol = length(a)))
for (k in 1:ncol(insertionsite)){
insertionsite[1,k]<-length(which(is.element(reads$pos,a[k])))
}
summary_stats$`Av. Coverage`[i]<-median(as.numeric(insertionsite[1,]))
summary_stats$`No.reads per IS`[i]<-paste(insertionsite[1,],collapse = ",")
summary_stats$`Total no. IS`[i]<-sum(as.numeric(insertionsite[1,]))
b<-which(insertionsite[1,]>4)
if (length(b>=1)){
insertionsite_more5<-as.data.frame(insertionsite[,b])
summary_stats$`No.Insertion sites DP>5`[i]<-ncol(insertionsite_more5)
summary_stats$`Insertion Index DP>5`[i]<-as.numeric(summary_stats$`No.Insertion sites DP>5`[i])/as.numeric(summary_stats$`Gene Length`[i])
summary_stats$`Av. Coverage DP>5`[i]<-median(as.numeric(insertionsite_more5[1,]))
}
}
}
sample_names<-c("B_S1_L001_R1_001")
what<-c("pos")
sample_names<-c("B_S1_L001_R1_001")
what<-c("pos")
for (j in 1:nrow(sample_names)){
summary_stats<-as.data.frame(matrix(0, nrow = nrow(features_table), ncol = 15))
summary_stats[,1:3]<-features_table[,3:5]
summary_stats[,4:5]<-features_table[,1:2]
colnames(summary_stats)<-c("Name","Type","Product","Start","End","Gene Length","No.Insertion sites", "Insertion Index", "Av. Coverage","No.Insertion sites DP>5", "Insertion Index DP>5", "Av. Coverage DP>5","Pos. IS","No.reads per IS","Total no. IS")
for (i in 1:nrow(features_table)){
if (summary_stats$End[i]>summary_stats$Start[i]){
summary_stats$`Gene Length`[i]<-(as.numeric(summary_stats$End[i])-as.numeric(summary_stats$Start[i]))+1
range1 <- IRanges(features_table$START[i],features_table$END[i])
which<-IRangesList(LT708304.1=range1)
} else {
summary_stats$`Gene Length`[i]<-(as.numeric(summary_stats$Start[i])-as.numeric(summary_stats$End[i]))+1
range2<- IRanges(features_table$END[i],features_table$START[i])
which<-IRangesList(LT708304.1=range2)
}
param<-ScanBamParam(what=what,which = which)
reads<-scanBam(paste(sample_names[j,1],".sort.bam",sep = ""),param = param)[[1]]
a<-unique(reads$pos)
if (length(a>=1)){
summary_stats$`No.Insertion sites`[i]<-length(a)
summary_stats$`Pos. IS`[i]<-paste(a,collapse = ",")
summary_stats$`Insertion Index`[i]<-as.numeric(summary_stats$`No.Insertion sites`[i])/as.numeric(summary_stats$`Gene Length`[i])
insertionsite<-as.data.frame(matrix(NA, nrow = 1, ncol = length(a)))
for (k in 1:ncol(insertionsite)){
insertionsite[1,k]<-length(which(is.element(reads$pos,a[k])))
}
summary_stats$`Av. Coverage`[i]<-median(as.numeric(insertionsite[1,]))
summary_stats$`No.reads per IS`[i]<-paste(insertionsite[1,],collapse = ",")
summary_stats$`Total no. IS`[i]<-sum(as.numeric(insertionsite[1,]))
b<-which(insertionsite[1,]>4)
if (length(b>=1)){
insertionsite_more5<-as.data.frame(insertionsite[,b])
summary_stats$`No.Insertion sites DP>5`[i]<-ncol(insertionsite_more5)
summary_stats$`Insertion Index DP>5`[i]<-as.numeric(summary_stats$`No.Insertion sites DP>5`[i])/as.numeric(summary_stats$`Gene Length`[i])
summary_stats$`Av. Coverage DP>5`[i]<-median(as.numeric(insertionsite_more5[1,]))
}
}
}
}
#sample_names<-read.table("names.txt",stringsAsFactors = F)
sample_names<-c("B_S1_L001_R1_001")
sample_names<-read.table("names.txt",stringsAsFactors = F)
what<-c("pos")
for (j in 1:nrow(sample_names)){
summary_stats<-as.data.frame(matrix(0, nrow = nrow(features_table), ncol = 15))
summary_stats[,1:3]<-features_table[,3:5]
summary_stats[,4:5]<-features_table[,1:2]
colnames(summary_stats)<-c("Name","Type","Product","Start","End","Gene Length","No.Insertion sites", "Insertion Index", "Av. Coverage","No.Insertion sites DP>5", "Insertion Index DP>5", "Av. Coverage DP>5","Pos. IS","No.reads per IS","Total no. IS")
for (i in 1:nrow(features_table)){
if (summary_stats$End[i]>summary_stats$Start[i]){
summary_stats$`Gene Length`[i]<-(as.numeric(summary_stats$End[i])-as.numeric(summary_stats$Start[i]))+1
range1 <- IRanges(features_table$START[i],features_table$END[i])
which<-IRangesList(LT708304.1=range1)
} else {
summary_stats$`Gene Length`[i]<-(as.numeric(summary_stats$Start[i])-as.numeric(summary_stats$End[i]))+1
range2<- IRanges(features_table$END[i],features_table$START[i])
which<-IRangesList(LT708304.1=range2)
}
param<-ScanBamParam(what=what,which = which)
reads<-scanBam(paste(sample_names[j,1],".sort.bam",sep = ""),param = param)[[1]]
a<-unique(reads$pos)
if (length(a>=1)){
summary_stats$`No.Insertion sites`[i]<-length(a)
summary_stats$`Pos. IS`[i]<-paste(a,collapse = ",")
summary_stats$`Insertion Index`[i]<-as.numeric(summary_stats$`No.Insertion sites`[i])/as.numeric(summary_stats$`Gene Length`[i])
insertionsite<-as.data.frame(matrix(NA, nrow = 1, ncol = length(a)))
for (k in 1:ncol(insertionsite)){
insertionsite[1,k]<-length(which(is.element(reads$pos,a[k])))
}
summary_stats$`Av. Coverage`[i]<-median(as.numeric(insertionsite[1,]))
summary_stats$`No.reads per IS`[i]<-paste(insertionsite[1,],collapse = ",")
summary_stats$`Total no. IS`[i]<-sum(as.numeric(insertionsite[1,]))
b<-which(insertionsite[1,]>4)
if (length(b>=1)){
insertionsite_more5<-as.data.frame(insertionsite[,b])
summary_stats$`No.Insertion sites DP>5`[i]<-ncol(insertionsite_more5)
summary_stats$`Insertion Index DP>5`[i]<-as.numeric(summary_stats$`No.Insertion sites DP>5`[i])/as.numeric(summary_stats$`Gene Length`[i])
summary_stats$`Av. Coverage DP>5`[i]<-median(as.numeric(insertionsite_more5[1,]))
}
}
}
}
summary_stats$`Av. Coverage`
summary_stats$`Insertion Index`
summary_stats$`No. reads per IS`
summary_stats$`No.reads per IS`
summary_stats$`No.Insertion sites`
summary_stats$`Pos. IS`
summary_stats$`Av. Coverage`
summary_stats$`Total no. IS`
summary_stats$`Total no. IS`
summary_stats$`Insertion Index`[29]
summary_stats$`No.Insertion sites`[29]
summary_stats$`No.Insertion sites`[29:42]
summary_stats$`Pos. IS`[29:42]
summary_stats$`No.reads per IS`[29:42]
summary_stats$`Av. Coverage`[29:42]
summary_stats$`Total no. IS`[29]
summary_stats$`No.Insertion sites DP>5`[29]
summary_stats$`No.Insertion sites DP>5`[29]
summary_stats$`Av. Coverage DP>5`[29]
summary_stats$`Insertion Index DP>5`[29]
summary_stats$`Gene Length`[29]
insertionsite[29]
insertionsite[29,]
insertionsite
numbersamples<-nrow(sample_names)
index_results<-data.frame(matrix(0,ncol=(numbersamples*2)+3,nrow=nrow(features_table)))
index_results[,1:3]<-features_table[,3:5]
colnames(index_results)<-c("NAME","TYPE","PRODUCT",rep(sample_names[,1],2))
for (i in 1:numbersamples){
tradis_res<-read.csv(file=paste(sample_names[i,1],"_TraDIS_summary.csv",sep = ""),header=T)
index_results[,i+3]<-tradis_res$Insertion.Index
index_results[,i+(numbersamples+3)]<-tradis_res$Insertion.Index.DP.5
}
sample_names
sample_names<-read.table("names.txt",stringsAsFactors = F)
sample_names<-read.table("names.txt",stringsAsFactors = F)
sample_names
sample_names<-read.table("names.txt",stringsAsFactors = F)
sample_names
numbersamples<-nrow(sample_names)
index_results<-data.frame(matrix(0,ncol=(numbersamples*2)+3,nrow=nrow(features_table)))
index_results[,1:3]<-features_table[,3:5]
colnames(index_results)<-c("NAME","TYPE","PRODUCT",rep(sample_names[,1],2))
for (i in 1:numbersamples){
tradis_res<-read.csv(file=paste(sample_names[i,1],"_TraDIS_summary.csv",sep = ""),header=T)
index_results[,i+3]<-tradis_res$Insertion.Index
index_results[,i+(numbersamples+3)]<-tradis_res$Insertion.Index.DP.5
}
index_results
View(index_results)[29]
View(index_results)[29,]
index_results[29,]
# average is mean of 3 samples
for (i in 1:nrow(index_results)){
index_results_average[i,2]<-mean(as.numeric(as.character(index_results[i,4:(numbersamples+3)])))
index_results_average[i,3]<-mean(as.numeric(as.character(index_results[i,(numbersamples+4):ncol(index_results)])))
}
# make graph for av index and av index dp5 for each sample for each feature
index_results_average<-data.frame(matrix(0,ncol=3,nrow=nrow(features_table)))
index_results_average[,1]<-features_table[,3]
colnames(index_results_average)<-c("NAME","Av.Index","Av.Index.DP5")
# average is mean of 3 samples
for (i in 1:nrow(index_results)){
index_results_average[i,2]<-mean(as.numeric(as.character(index_results[i,4:(numbersamples+3)])))
index_results_average[i,3]<-mean(as.numeric(as.character(index_results[i,(numbersamples+4):ncol(index_results)])))
}
index_results_average
jpeg('Insertion.index.jpg')
insertion_graph<-hist(index_results_average[,2],xlim = c(0,0.05),ylim = c(0,400),nclass = 700,xlab = "Insertion Index",ylab = "Density",main = NA)
dev.off()
# make graph for average coverage and av coverage dp5
index_results<-data.frame(matrix(0,ncol=(numbersamples*2)+3,nrow=nrow(features_table)))
index_results[,1:3]<-features_table[,3:5]
colnames(index_results)<-c("NAME","TYPE","PRODUCT",rep(sample_names[,1],2))
for (i in 1:numbersamples){
tradis_res<-read.csv(file=paste(sample_names[i,1],"_TraDIS_summary.csv",sep = ""),header=T)
index_results[,i+3]<-tradis_res$Av..Coverage
index_results[,i+(numbersamples+3)]<-tradis_res$Av..Coverage.DP.5
}
index_results_average<-data.frame(matrix(0,ncol=3,nrow=nrow(features_table)))
index_results_average[,1]<-features_table[,3]
colnames(index_results_average)<-c("NAME","Av.Index","Av.Index.DP5")
for (i in 1:nrow(index_results)){
index_results_average[i,2]<-mean(as.numeric(as.character(index_results[i,4:(numbersamples+3)])))
index_results_average[i,3]<-mean(as.numeric(as.character(index_results[i,(numbersamples+4):ncol(index_results)])))
}
jpeg('Insertion.index.jpg')
coverage_graph<-hist(index_results_average[,2],xlim = c(0,60),nclass = 300,xlab = "Av.coverage.per.gene",ylab = "Density",main = NA)
dev.off()
non_norm<-as.data.frame(matrix(0, nrow = nrow(insertion_table), ncol = 4))
sample_names<-read.table("names_wig.txt",stringsAsFactors = F)
for (j in 1:nrow(sample_names)){
insertion_table<-read.csv(paste(sample_names[j,1],".wig",sep = ""), header=F)
non_norm<-as.data.frame(matrix(0, nrow = nrow(insertion_table), ncol = 4))
}
non_norm
non_norm<-as.data.frame(matrix(0, nrow = nrow(insertion_table), ncol = 3))
insertion_table[0:20]
insertion_table[20,]
insertion_table<-read.csv(paste(sample_names[j,1],".wig",sep = ""), header=T)
insertion_table[20,]
insertion_table[1,]
insertion_table<-read.csv(paste(sample_names[j,1],".wig",sep = ""), header=F)
insertion_table<-read.csv(paste(sample_names[j,1],".wig",sep = ""), header=F)
insertion_table[1,]
insertion_table[1:20,]
#non_norm<-as.data.frame(matrix(0, nrow = nrow(insertion_table), ncol = 3))
non_norm<-data.frame(row.names = 1)
B_table<-read.csv("B_R1.wig", header=F)
non_norm<-data.frame(B_table[2:,], row.names = 1)
# positions start on 3rd line
B_table<-read.csv("B_R1.wig", header=F)
non_norm<-data.frame(B_table, row.names = 1)
# positions start on 3rd line
View(non_norm)
B_table<-read.csv("B_R1.wig", sep = " ", header=F)
non_norm<-data.frame(B_table, row.names = 1)
# positions start on 3rd line
View(non_norm)
B_table<-read.csv("B_R1.wig", sep = " ")
non_norm<-data.frame(B_table, row.names = 1)
View(non_norm)
B_table<-read.csv("B_R1.wig", sep = " ", skip=2)
non_norm<-data.frame(B_table, row.names = 1)
# positions start on 3rd line
View(non_norm)
non_norm<-data.frame(B_table, row.names = 1, colnames<-c("B"))
View(non_norm)
non_norm<-data.frame(B_table, row.names = 1)
View(non_norm)
non_norm<-as.data.frame(matrix(0, nrow = nrow(B_table), ncol =3))
View(non_norm)
pos_vector<-B_table[,1]
pos_vector
non_norm<-as.data.frame(matrix(0, nrow = nrow(B_table), ncol =3), row.names <-pos_vector)
View(non_norm)
D_vector<-D_table[,1]
B_table<-read.csv("B_R1.wig", sep = " ", skip=2)   # positions start on 3rd line
D_table<-read.csv("D_R1.wig", sep = " ", skip=2)
G_table<-read.csv("G_R1.wig", sep = " ", skip=2)
D_vector<-D_table[,1]
non_norm[,1]<-B_table[,2]
View(non_norm)
col_names<-c('B', 'D', 'G')
non_norm[,1]<-B_table[,2]
non_norm<-as.data.frame(matrix(0, nrow = nrow(B_table), ncol =3), row.names <-pos_vector)
col_names<-c('B', 'D', 'G')
non_norm[,1]<-B_table[,2]
non_norm[,2]<-D_table[,2]
non_norm[,3]<-G_table[,2]
View(non_norm)
non_norm<-as.data.frame(matrix(0, nrow = nrow(B_table), ncol =3), row.names <-pos_vector)
col_names(non_norm)<-c('B', 'D', 'G')
non_norm[,1]<-B_table[,2]
non_norm[,2]<-D_table[,2]
non_norm[,3]<-G_table[,2]
View(non_norm)
colnames(non_norm)<-c('B', 'D', 'G')
View(non_norm)
cor(non_norm$B, non_norm$D, "kendall")
cor(non_norm$B, non_norm$D, method = "kendall")
cor.test(non_norm$B, non_norm$D, method = "kendall")
cor.test(non_norm$B, non_norm$G, method = "kendall")
cor.test(non_norm$B, non_norm$G, method = "kendall")
res_ttr <- cor.fk(ttr_norm, method = 'kendall')
round(res_ttr, 2)
library("mvtnorm", lib.loc="/Library/Frameworks/R.framework/Versions/3.5/Resources/library")
library(pcaPP)
res_ttr <- cor.fk(ttr_norm, method = 'kendall')
round(res_ttr, 2)
res_ttr <- cor(ttr_norm)
round(res_ttr, 2)
ttr_norm<-as.data.frame(matrix(0, nrow = nrow(B_ttr_table), ncol =3), row.names <-pos_vector)
colnames(ttr_norm)<-c('B', 'D', 'G')
ttr_norm[,1]<-B_ttr_table[,2]
ttr_norm[,2]<-D_ttr_table[,2]
ttr_norm[,3]<-G_ttr_table[,2]
B_ttr_table<-read.csv("B_R1_ttr.wig", sep = " ", skip=2)   # positions start on 3rd line
D_ttr_table<-read.csv("D_R1_ttr.wig", sep = " ", skip=2)
G_ttr_table<-read.csv("G_R1_ttr.wig", sep = " ", skip=2)
pos_vector<-B_ttr_table[,1]
ttr_norm<-as.data.frame(matrix(0, nrow = nrow(B_ttr_table), ncol =3), row.names <-pos_vector)
colnames(ttr_norm)<-c('B', 'D', 'G')
ttr_norm[,1]<-B_ttr_table[,2]
ttr_norm[,2]<-D_ttr_table[,2]
ttr_norm[,3]<-G_ttr_table[,2]
head(ttr_norm, 20)
res_ttr <- cor(ttr_norm)
round(res_ttr, 2)
numbersamples<-nrow(sample_names)
index_results<-data.frame(matrix(0,ncol=(numbersamples*2)+3,nrow=nrow(features_table)))
index_results[,1:3]<-features_table[,3:5]
colnames(index_results)<-c("NAME","TYPE","PRODUCT",rep(sample_names[,1],2))
for (i in 1:numbersamples){
tradis_res<-read.csv(file=paste(sample_names[i,1],"_TraDIS_summary.csv",sep = ""),header=T)
index_results[,i+3]<-tradis_res$Insertion.Index
index_results[,i+(numbersamples+3)]<-tradis_res$Insertion.Index.DP.5
}
# make graph for av index and av index dp5 for each sample for each feature
index_results_average<-data.frame(matrix(0,ncol=3,nrow=nrow(features_table)))
index_results_average[,1]<-features_table[,3]
colnames(index_results_average)<-c("NAME","Av.Index","Av.Index.DP5")
# average is mean of av index for all 3 samples
for (i in 1:nrow(index_results)){
index_results_average[i,2]<-mean(as.numeric(as.character(index_results[i,4:(numbersamples+3)])))
index_results_average[i,3]<-mean(as.numeric(as.character(index_results[i,(numbersamples+4):ncol(index_results)])))
}
jpeg('Insertion.index.jpg')
insertion_graph<-hist(index_results_average[,2],xlim = c(0,0.05),ylim = c(0,400),nclass = 700,xlab = "Insertion Index",ylab = "Density",main = NA)
dev.off()
options(scipen=999,stringsAsFactors = F)
library(Rsamtools)
features_table<-read.csv("M_bovis_features-locusAsName-aug19.csv",header=T)
sample_names<-read.table("names.txt",stringsAsFactors = F)
what<-c("pos")
for (j in 1:nrow(sample_names)){
summary_stats<-as.data.frame(matrix(0, nrow = nrow(features_table), ncol = 15))
summary_stats[,1:3]<-features_table[,3:5]
summary_stats[,4:5]<-features_table[,1:2]
colnames(summary_stats)<-c("Name","Type","Product","Start","End","Gene Length","No.Insertion sites", "Insertion Index", "Av. Coverage","No.Insertion sites DP>5", "Insertion Index DP>5", "Av. Coverage DP>5","Pos. IS","No.reads per IS","Total no. IS")
for (i in 1:nrow(features_table)){
if (summary_stats$End[i]>summary_stats$Start[i]){
summary_stats$`Gene Length`[i]<-(as.numeric(summary_stats$End[i])-as.numeric(summary_stats$Start[i]))+1
range1 <- IRanges(features_table$START[i],features_table$END[i])
which<-IRangesList(LT708304.1=range1)
} else {
summary_stats$`Gene Length`[i]<-(as.numeric(summary_stats$Start[i])-as.numeric(summary_stats$End[i]))+1
range2<- IRanges(features_table$END[i],features_table$START[i])
which<-IRangesList(LT708304.1=range2)
}
param<-ScanBamParam(what=what,which = which)
reads<-scanBam(paste(sample_names[j,1],".sort.bam",sep = ""),param = param)[[1]]
a<-unique(reads$pos)
if (length(a>=1)){
summary_stats$`No.Insertion sites`[i]<-length(a)
summary_stats$`Pos. IS`[i]<-paste(a,collapse = ",")
summary_stats$`Insertion Index`[i]<-as.numeric(summary_stats$`No.Insertion sites`[i])/as.numeric(summary_stats$`Gene Length`[i])
insertionsite<-as.data.frame(matrix(NA, nrow = 1, ncol = length(a)))
for (k in 1:ncol(insertionsite)){
insertionsite[1,k]<-length(which(is.element(reads$pos,a[k])))
}
summary_stats$`Av. Coverage`[i]<-median(as.numeric(insertionsite[1,]))
summary_stats$`No.reads per IS`[i]<-paste(insertionsite[1,],collapse = ",")
summary_stats$`Total no. IS`[i]<-sum(as.numeric(insertionsite[1,]))
b<-which(insertionsite[1,]>4)
if (length(b>=1)){
insertionsite_more5<-as.data.frame(insertionsite[,b])
summary_stats$`No.Insertion sites DP>5`[i]<-ncol(insertionsite_more5)
summary_stats$`Insertion Index DP>5`[i]<-as.numeric(summary_stats$`No.Insertion sites DP>5`[i])/as.numeric(summary_stats$`Gene Length`[i])
summary_stats$`Av. Coverage DP>5`[i]<-median(as.numeric(insertionsite_more5[1,]))
}
}
}
}
